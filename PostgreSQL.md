# PostgreSQL
Буду устанавливать PostgreSQL 10 из репозитория buster.  

### Установка
Посмотреть что предлагают:  
`sudo apt-get update` - не забываем  
`apt-cache policy postgresql` - посмотреть какая версия будет устанавливаться  
`apt-cache policy postgresql-10` - посмотреть какая минорная версия PostgreSQL 10 будет установлена  
`apt-cache policy postgresql-9.6` - посмотреть какая минорная версия PostgreSQL 9.6 будет установлена  
Для установки версии 10 на Debian Stretch нужно [добавить репозиторий Buster](README.md#Добавление-репозитория-buster).  

Собственно установка:  
`sudo apt-get install postgresql` - установка ядра версии по умолчанию. Скорее всего самой последней.  
> Также можно указать, какую версию ставить, командами  
> `sudo apt-get install postgresql-10` или  
> `sudo apt-get install postgresql-9.6`  
При этом будут установлены и пакеты libpq5 postgresql-client-10 postgresql-client-common postgresql-common  

### Запуск
Тут всё как обычно:  
`sudo service postgresql start` - запуск  
`sudo service postgresql stop` - остановка  
`sudo service postgresql restart` - перезапуск  

### Первоначальная настройка пользователей
По умолчанию для доступа к базам Postgres использует концепцию ролей. Это как _пользователи_ и _группы_ в одном понятии.  
После установки Postgres настраивает _идентичную_ аутентификацию (ident authentication). Это означает, что Postgres ассоциирует свои роли с подходящими Unix/Linux аккаунтами. Если роль существует в Postgres, пользователь с этим же именем в Unix/Linux сможет осуществлять вход под этой ролью.  

После установки создаётся роль `postgres` и соответсвующий ему пользователь Linux с именем `postgres`. Этого пользователя лучше не модифицоровать. В том числе и не менять ему пароль. Потому что обычно он заблокирован в ОС. Никто не может войти в ОС как пользователь `postgres`.  

#### Создаём новую роль
Для этого нужно войти в командную строку postgres под ролью `postgres`, которая является суперпользователем, создать новую роль и назначить ей необходимые привилегии. ([Статья](https://postgrespro.ru/docs/postgresql/9.6/sql-createrole))  
```sql
sudo -u postgres psql
postgres=# \du
postgres=# CREATE ROLE имя_пользователя WITH LOGIN CREATEDB;
postgres=# \du
postgres=# \password имя_пользователя
Введите новый пароль:
Повторите его:
postgres=# \q
```
Если в ОС присутствует пользователь с таким же именем, как только что созданная роль БД, то можно выполнить вход под этим пользователем и работать с базой. Если такого пользователя ОС нет, то можно использовать для входа следующую команду. Она подключит к базе `postgres` (база, созданная по умолчанию) под ролью `user_name`.  
`psql -U user_name -d postgres -h 127.0.0.1 -W`
