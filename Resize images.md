# Скрипт для сжатия фоток для превью на сайте
Чтобы на сайте можно было комфортно просматривать фотки, их нужно сжать до 1200 px по самой большой стороне.
Вручную это делать не хочется, поэтому хочу настроить скрипт. Он будет регулярно проверять папки с фотографиями
и создавать для них превью меньшего размера.

### Установка
Не самая свежая версия, но пока мне всё равно.  
`sudo apt-get install imagemagick`  
Это будет установлена версия ImageMagick 6.9.11, в то время как самая свежая сейчас 7.1.1  
Для версии 6 документацию нужно искать на [legacy.imagemagick.org](https://legacy.imagemagick.org/)  

### Подключение
Скрипт надодится в проекте **okfilm_2018** по пути `utilities/resize_shared_images.sh`.  
Для его подключения нужно добавить задачу в крон. При чём в крон пользователся okfilm, он же пользуется сетевым диском.  

Посмотреть список уже добавленных кронов пользователя:  
`sudo crontab -u okfilm -l`  

Добавить новый крон вручную:  
сначала нужно установить пользователя okfilm владельцем скрипта  
`sudo chown okfilm:okfilm /srv/okfilm_2018/utilities/resize_shared_images.sh`  
затем открыть редактор задач крона  
`sudo crontab -u okfilm -e`  
и прописать задачу  
`*/5 * * * * /srv/okfilm_2018/utilities/resize_shared_images.sh`  

### Отладка крона
Включить логирование срабатываний крона `sudo nano /etc/rsyslog.conf`  
в этом файле раскомментировать строку `#cron.*                          /var/log/cron.log`  
после чего перезапустить сервис `sudo service rsyslog restart`.  
Логи будут в файле /var/log/cron.log  
Если нужно перенаправить вывод скрипта в файл, то записываем крон вот так:  
`*/1 * * * * /srv/okfilm_2018/utilities/resize_shared_images.sh >> /home/okfilm/resize_cron.log 2>&1`  

Настраивать правило для крона удобно тут: https://crontab.guru/
