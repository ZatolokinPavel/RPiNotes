# Пользователи
Как настраивать пользователя pi я всё ещё не знаю.  
А здесь будет описано как добавить пользователя okfilm для только чтобы можно было загружать файлы на сайт в раздел "файлообменник" и не натупить больше нигде.  

### Полезные команды
`$ cat /etc/passwd` - просмотр списка всех пользователей в формате account:password:UID:GID:GECOS:directory:shell  
`$ w` или `$ who` - показать какие пользователи сейчас активны и что выполняют  
`$ lastlog` - дата последнего входа для каждого пользователя  

### Добавление пользователя okfilm для загрузки файлов  
https://www.dmosk.ru/miniinstruktions.php?mini=ssh-chroot  
http://forum.ispsystem.ru/showthread.php?3528-Доступ-по-SSH-в-chroot-окружение/page4  

0. Сначала готовим папку для загрузки файлов.  
Для этого создаём папку `/mnt/shared-flash/`, настраиваем [монтирование в неё флешки](USB%20флешка.md), перемещаем все файлы из `/var/www/shared-global/` на флешку и ставим вместо папки `/var/www/shared-global/` символьную ссылку на папку `/mnt/shared-flash/`. Таким образом у нас весь файлообменник будет храниться на флешке.  
1. Собственно, добавляем пользователя okfilm:  
`$ sudo adduser okfilm`  
`$ sudo passwd okfilm` и задаём ему пароль.  
2. Создаём пользователю `okfilm` сертификат, сохраняем его в `~/.ssh/authorized_keys`, копируем на комп и подготавливаем для PuTTY. Всё это описано [здесь](SSH.md#сертификаты-для-ssh).  
3. Добавляем пользователя в список разрешенных для доступа по ssh.  
Для этого в файле `/etc/ssh/sshd_config` дописываем его в параметр `AllowUsers`  
4. Запрещаем пользователю okfilm просматривать любые каталоги кроме его домашней папки. Для этого в файле `/etc/ssh/sshd_config` нужно закомментировать одну строчку и добавить вместо неё вторую:  
   `#Subsystem sftp /usr/lib/openssh/sftp-server`  
   `Subsystem sftp internal-sftp -f AUTH -l VERBOSE`  
   Тем самым мы включаем встроенный sftp сервер вместо того, который внешний. Внешний уже устарел, а встроенный лучше практически во всех отношениях.  
   И в самый конец нужно добавить следующие строки:  
   ```
   Match user okfilm
       ChrootDirectory /mnt/shared-flash
       ForceCommand internal-sftp
       AllowTcpForwarding no
       X11Forwarding no
   ```
   Важно чтобы все папки в пути `ChrootDirectory /mnt/shared-flash` имели права 755, и их владельцем был root. А уж внутри можно создавать любые папки с любыми правами.  
5. Перезапускам sshd `$ sudo service ssh restart`   
6. Под обычным пользователем переходим в домашнюю папку пользователя okfilm и создаём символьную ссылку на папку файлообменника:  
   `/home/okfilm $ sudo ln -s /var/www/shared-global/`

### Изменение данных пользователя  
`chfn [параметры] [ПОЛЬЗОВАТЕЛЬ]` - поменять параметры GECOS для пользователя  
